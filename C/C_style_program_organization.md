
> 作者：nicer  
> 微信公众号：好好编程

# 程序的组件

程序是人和机器阅读的指令集合。
好的程序即要机器能高效执行，也要让人读着易懂。

而好的程序由好的模块组成。

## 模块设计

一个模块由一个或多个程序文件组成，它会提供一组特定的功能。
当我拿到一个模块时，怎么样能马上知道它有什么样的功能，我该如何使用它？

可以做这样一个类比，我们拿到一台打印机，在我们不了解它的时候，我们会先看它的使用说明书。
说明书里会有这个打印机的使用方法。

但是说明书只记录使用说明，不记录这个打印机的实现原理，这样这个说明书才足够简单易读。

我们在设计模块的时候，可以把模块分两部分：**公共部分** 与 **私有部分**。

公共部分就像是说明书，它告诉使用者如何来使用这个模块。通常我们把公共部分放在`.h`文件。
公共部分主要包括：结构体、函数声明、宏定义、说明注释等。

私有部分就是具体的实现方法，放在`.c`文件中。如果不需要了解模块的具体实现，一般不需要阅读这私有部分。
有的模块为了保密只会提供编译后的文件与`.h`文件，用户只能阅读`.h`而无法查看到具体实现。

## 库的头文件问题

当一个库由许多模块组成的时候，就会碰到头文件问题。
是使用一个头文件来包含所有的公开信息，还是多个头文件对应不同的模块呢？

**多个头文件**

多个头文件，库中不同的模块拥有自己的头文件。

例如：

```
#include <Xll/Intrinsic.h>
#include <Xll/Shell.h>
#include <Xm/Xm.h>
#include <Xm/Label.h>
#include <Xm/RowColumn.h>
#include <Xm/PushB.h>
#include <Xm/Separator.h>
#include <Xm/BulletinB.h>
#include <Xm/CascadeB.h>
```

优点：
* 允许使用者包含所需要的部分，不需要的部分则不包含。

缺点：
* 头文件多
* 很容易忘记哪个`#include`是否是必需的。

**单个头文件**

单个头文件就是把所有公开的信息全部放在一个头文件中。

例如Windows开发中常见的：

```
#include <windows.h>
```

优点：
* 看上去很简单
* 只要包含一个头文件，就可以使用库中的包有模块

缺点：
* 编译会变慢，因为包含了整个库

**其他方法**

这种办法只有一个头文件，但是使用宏来定义哪些模块被引用。

Borland's Turbo Vision library (TV) 就使用了这种方法。

```
#define Uses_TRect
#define Uses_TStatusLine
#define Uses_TStatusDef
#define Uses_TStatusItem
#include <tv.h>
```

这种方法可以有效的避免引入无用的模块，但是需要加入正确的宏定义程序才能正常编译，某种程度上复杂度更高。

综上，这三种方法都各有千秋，选择一个适合你的方式就行。

