
> 作者：nicer  
> 微信公众号：好好编程

C风格要素之 表达式
===================================

运算符的优先级
--------------------

运算符有很多，比如算术运算符 `+ - * %`, 比较运算符 `> < ==`，逻辑运算符`|| && !` 等。
在一个表达式中，不同的运算符之间的优先顺序有可能是一不样的，光靠记忆来区分是很难的。

* __表达式中出现优先级不一样的操作符时，使用 `()` 进行分隔__

示例：
```
x = a + b - d;                  /* 操作符优先级相同，不需要括号 */
x = (a * 3) + c + d;            /* 操作符优先级不同，需要括号*/
x = ( a == b ) ? a : ( a – b ); /* 操作符优先级不同，需要括号*/
```

if 语句
--------------------

if语句很常用，所以写好if语句很重要。

* __布尔类型判断的写法__

C99标准之前没有布尔型，但是更现代的C是有布尔型的，即使没有，我们也经常根据需要自定义一个布尔类型。

布尔类型的定义是`零`值为假，其他值都为`真`。

良好的布尔类型判断示例：
```
if(flag)    /* 表示flag 为真 */
if(!flag)   /* 表示flag为假 */ 
```

* __整型变量与零值比较__

应当将整型变量用 `==` 或 `!=` 直接与 `0` 比较。

示例：
```
// 好的风格
if (value == 0)
if (value != 0)

// 差的风格
if (value)      // 会让人误解value是布尔变量
if (!value)
```

* __浮点变量与零值比较__

无论是float 还是double 类型的变量，都有精度限制。所以一定要避免将浮点变量用`==`或`!=`与数字比较，应该设法转化成`>=`或`<=`形式。

示例：
```
// 正确
if ((x>=-EPSINON) && (x<=EPSINON))  /* EPSINON 是允许的误差（即精度）*/

// 错误
if (x == 0.0)
```

* __指针变量与零值比较__

指针变量的零值是空（记为`NULL`）。尽管NULL 的值与0 相同，但是两者意义不同。
应当将指针变量用`==`或`!=`与`NULL`比较。

示例：
```
// 好的风格
if (p == NULL)  /* p 与NULL 显式比较，强调p 是指针变量 */
if (p != NULL)

// 差的风格
if (p)          /* 容易让人误解p 是布尔变量 */
if (!p)
```

for语句
--------------------

* __建议：for 语句的循环控制变量的取值采用`半开半闭区间`写法__

半开半闭区间`0 =< x < N`，循环次数为N ；闭区间`0 =< x <= N-1`，循环次数也是N。

半开半闭区间的写法比较容易整理，建议使用这个。

示例：
```
for(i=0; i<N; i++)      /* 循环次数为N */
{
    ...
}
```

switch语句
--------------------

switch的每个case不要忘记加break；如果是特殊需求不加break，建议在下一个case前加上注释。
原因就是加了注释后，其他人读到这段代码的时候知道是有意为之，而不会误以为是个错误。

示例：
```
switch (state) 
{
    case BEGIN_STATE:
        printf("Beginning\n");
        /* Fall through to case PROC_STATE */

    case PROC_STATE:
        printf("Processing\n");
        break;

    case FINISH_STATE:
        printf("Finishing\n");
        break;

    default:break;
}
```

goto语句
--------------------

goto语句会破坏程序的流程，很可能会引起错误，在你不熟悉goto的使用时，尽量不要使用它。

修饰符的位置
------------------------

修饰符 `*` 和 `&` 应该靠近数据类型还是该靠近变量名，是个有争议的活题。

若将修饰符 `*` 靠近数据类型，例如：`int* x;`从语义上讲此写法比较直观，即`x`是`int`类型的指针。

上述写法的弊端是容易引起误解，例如：`int* x, y;`此处 `y` 容易被误解为指针变量。

**方法一**：

* 将修饰符 `*` 和 `&` 紧靠类型名
* 一行只写一条语句

```
char* name;     // 很直观，name 是个char型指针
int* a;
int* b;
int c;
int d;
```

**方法二**：

* 将修饰符 `*` 和 `&` 紧靠变量名

```
char *name;
int *x, y;          // y 不会被误解为指针
```

